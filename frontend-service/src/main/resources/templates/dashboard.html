<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - –ë–∞–Ω–∫</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .bank-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
        }
        .balance-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-top: -40px;
        }
        .transaction-item {
            border-left: 4px solid #667eea;
            padding-left: 15px;
            margin-bottom: 15px;
        }
        .positive {
            color: #28a745;
        }
        .negative {
            color: #dc3545;
        }
        .topup-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .balance-error {
            color: #dc3545;
            font-style: italic;
        }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ -->
    <header class="bank-header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2>üè¶ –ë–∞–Ω–∫</h2>
                    <p>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</p>
                </div>
                <div>
                    <span>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <strong th:text="${user.name}">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</strong></span>
                    <a href="/logout" class="btn btn-outline-light btn-sm ms-3">–í—ã–π—Ç–∏</a>
                </div>
            </div>
        </div>
    </header>

    <div class="container mt-4">
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –±–∞–ª–∞–Ω—Å–∞ -->
        <div class="balance-card">
            <div class="row">
                <div class="col-md-6">
                    <h5>–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å</h5>
                    <h1 class="display-4" th:text="${user.balance}">1 250 000 ‚ÇΩ</h1>
                    <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞ -->
                    <div th:if="${balanceError}" class="balance-error">
                        <small>‚ö†Ô∏è <span th:text="${balanceError}">–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞</span></small>
                    </div>
                    <p class="text-muted">–°—á–µ—Ç: <span th:text="${user.accountNumber}">40702810000000012345</span></p>
                </div>
                <div class="col-md-6">
                    <div class="text-end">
                        <p><strong>–í–∞–ª—é—Ç–∞:</strong> <span th:text="${user.currency}">RUB</span></p>
                        <p><strong>–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥:</strong> <span th:text="${user.lastLogin}">–°–µ–≥–æ–¥–Ω—è, 14:30</span></p>
                        <p><strong>Email:</strong> <span th:text="${user.email}">ivan@bank.com</span></p>
                    </div>
                </div>
            </div>
            
            <!-- –§–æ—Ä–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ -->
            <div class="topup-form">
                <h5>–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</h5>
                <form id="topupForm">
                    <div class="mb-3">
                        <label for="amount" class="form-label">–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (‚ÇΩ)</label>
                        <input type="number" class="form-control" id="amount" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" min="0.01" step="0.01" required>
                    </div>
                    <button type="submit" class="btn btn-success">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                </form>
                <div id="resultMessage" class="mt-3" style="display: none;"></div>
            </div>
        </div>

        <!-- –û–ø–µ—Ä–∞—Ü–∏–∏ -->
        <div class="row mt-4">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</h5>
                    </div>
                    <div class="card-body">
                        <div th:if="${transactions.empty}">
                            <p class="text-muted">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</p>
                        </div>
                        <div th:unless="${transactions.empty}" th:each="transaction : ${transactions}" class="transaction-item">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 th:text="${transaction.description}">–û–ø–µ—Ä–∞—Ü–∏—è</h6>
                                    <small class="text-muted" th:text="${transaction.date}">2024-01-15</small>
                                </div>
                                <div>
                                    <h5 th:class="${#strings.startsWith(transaction.amount, '+')} ? 'positive' : 'negative'"
                                        th:text="${transaction.amount}">
                                        -15 000 ‚ÇΩ
                                    </h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –¥–µ–Ω—å–≥–∏</button>
                            <button class="btn btn-outline-success" onclick="document.getElementById('amount').focus()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å —Å—á–µ—Ç</button>
                            <button class="btn btn-outline-info">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</button>
                            <button class="btn btn-outline-warning">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—á–µ—Ç–∞</button>
                        </div>
                    </div>
                </div>

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="card mt-3">
                    <div class="card-body">
                        <h6>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ</h6>
                        <p class="small text-muted mb-0">
                            –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: OAuth2<br>
                            –°–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: localhost:9000<br>
                            Frontend —Å–µ—Ä–≤–∏—Å: localhost:8080<br>
                            –í–µ—Ä—Å–∏—è: 1.0.0
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="mt-5 py-3 bg-light text-center">
        <div class="container">
            <p class="mb-0 text-muted">¬© 2024 –ë–∞–Ω–∫. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('topupForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const amount = document.getElementById('amount').value;
            const resultMessage = document.getElementById('resultMessage');
            
            if (!amount || parseFloat(amount) <= 0) {
                resultMessage.className = 'alert alert-danger mt-3';
                resultMessage.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É';
                resultMessage.style.display = 'block';
                return;
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
            fetch('/api/topup/balance', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({amount: amount})
            })
            .then(response => response.json())
            .then(data => {
                resultMessage.className = 'alert alert-success mt-3';
                resultMessage.innerHTML = `
                    <strong>–£—Å–ø–µ—à–Ω–æ!</strong> –ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${amount} ‚ÇΩ<br>
                    –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: ${data.transactionId}
                `;
                resultMessage.style.display = 'block';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
                document.querySelector('.display-4').textContent = 
                    (parseFloat(document.querySelector('.display-4').textContent.replace(' ‚ÇΩ', '')) + parseFloat(amount)).toFixed(2) + ' ‚ÇΩ';
                
                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                document.getElementById('amount').value = '';
            })
            .catch(error => {
                resultMessage.className = 'alert alert-danger mt-3';
                resultMessage.innerHTML = '<strong>–û—à–∏–±–∫–∞!</strong> –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞';
                resultMessage.style.display = 'block';
            });
        });
    </script>
</body>
</html>